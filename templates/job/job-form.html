<!-- Job Description Form Template -->
<div class="compact-toggle">
    <label>
        <input type="checkbox" id="job-compact-toggle" onchange="toggleCompactForm('job-form')">
        Show only essential fields
    </label>
</div>

<div class="form-progress">
    <div class="progress-bar" id="job-form-progress"></div>
    <div class="progress-label">Form completion: <span id="job-progress-percent">0%</span></div>
</div>

<!-- JD Upload Component -->
<div id="jd-upload-container" class="jd-upload-container">
    <h2>Upload Job Description</h2>
    <p class="upload-description">Upload a job description file to automatically extract and enhance the content.</p>
    
    <div class="upload-box" id="upload-box" ondragover="handleDragOver(event)" ondrop="handleDrop(event)" onclick="triggerFileInput()">
        <div class="upload-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        </div>
        <p>Drag and drop file here or <span class="browse-text">browse</span></p>
        <p class="supported-formats">Supported formats: PDF, DOCX, DOC, JPG, PNG</p>
        <input type="file" id="jd-file-input" accept=".pdf,.docx,.doc,.jpg,.jpeg,.png" style="display: none;" onchange="handleFileSelect(event)">
    </div>
    
    <div class="file-info" id="file-info" style="display: none;">
        <div class="file-details">
            <span id="file-name"></span>
            <span id="file-size"></span>
        </div>
        <button class="remove-file-btn" onclick="removeFile()">Remove</button>
    </div>
    
    <div class="upload-actions">
        <button id="upload-jd-btn" onclick="uploadJobDescription()" disabled>Upload & Process</button>
    </div>
    
    <div id="upload-progress" class="upload-progress" style="display: none;">
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-status" id="progress-status">Processing...</div>
    </div>
    
    <!-- Results will be shown here after processing -->
    <div id="processing-results" class="processing-results" style="display: none;">
        <h3>Extracted Information</h3>
        <div id="extracted-data"></div>
        
        <div class="result-actions">
            <button id="use-results-btn" onclick="useExtractedResults()">Use These Results</button>
            <button id="edit-results-btn" onclick="editExtractedResults()">Edit Before Using</button>
        </div>
    </div>
</div>

<div class="form-tips">
    <div class="tip">
        <span class="tip-icon">ðŸ’¡</span>
        <span class="tip-text">Focus on what makes this role unique to attract the right candidates.</span>
    </div>
    <div class="tip">
        <span class="tip-icon">âœ“</span>
        <span class="tip-text">Start with job title, summary, and requirements - you can add more details later.</span>
    </div>
</div>

<form id="job-form">
    <!-- Hidden required field for company_id -->
    <input type="hidden" id="company-id" name="company_id" value="">
    
    <!-- Required Fields -->
    <div class="form-section">
        <h2>Basic Job Information</h2>
        <div class="form-group">
            <label for="job-title" class="required-label">Job Title:</label>
            <input type="text" id="job-title" name="title" placeholder="Enter job title" required>
            <div class="field-hint">Use a clear, specific title that candidates would search for.</div>
        </div>
        <div class="form-group">
            <label for="job-code">Job Code:</label>
            <input type="text" id="job-code" name="job_code" placeholder="Internal reference code (optional)">
            <div class="field-hint">For your internal tracking purposes.</div>
        </div>
    </div>

    <!-- Job Summary Section - Essential Fields -->
    <div class="form-section">
        <h2>Key Job Details</h2>
        <div class="section-description">These are the essential details candidates look for first.</div>
        
        <div class="essential-fields">
            <div class="form-group optional-field" id="job-summary-group">
                <label for="job-summary">Job Summary:</label>
                <textarea id="job-summary" name="job_summary" placeholder="Brief overview of the role and its purpose"></textarea>
                <div class="field-hint">A concise summary that covers what the role does and its importance.</div>
            </div>
            
            <div class="form-group optional-field" id="work-model-group">
                <label for="work-model">Work Model:</label>
                <input type="text" id="work-model" name="work_model" placeholder="E.g., Remote, Hybrid (3 days in office), On-site">
                <div class="field-hint">One of the first things candidates want to know.</div>
            </div>
            
            <div class="form-group optional-field" id="job-level-group">
                <label for="job-level">Job Level:</label>
                <input type="text" id="job-level" name="job_level" placeholder="E.g., Entry, Mid, Senior, Lead">
                <div class="field-hint">Helps candidates understand if this role matches their experience level.</div>
            </div>
        </div>
    </div>

    <!-- Basic Job Information -->
    <div class="form-section">
        <h2>Job Classification</h2>
        <div class="field-checkboxes">
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('job-level')">
                Job Level
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('job-department')">
                Department
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('job-function')">
                Job Function
            </label>
        </div>
        
        <div class="form-group optional-field" id="job-department-group">
            <label for="job-department">Department:</label>
            <input type="text" id="job-department" name="department" placeholder="E.g., Marketing, Engineering, Sales">
        </div>
        <div class="form-group optional-field" id="job-function-group">
            <label for="job-function">Job Function:</label>
            <input type="text" id="job-function" name="job_function" placeholder="E.g., Software Development, UX/UI Design">
        </div>
    </div>
    
    <!-- Job Posting Metadata -->
    <div class="form-section">
        <h2>Employment Details</h2>
        <div class="field-checkboxes">
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('contract-duration')">
                Contract Duration
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('time-commitment')">
                Time Commitment
            </label>
        </div>
        
        <div class="form-group optional-field" id="contract-duration-group">
            <label for="contract-duration">Contract Duration:</label>
            <input type="text" id="contract-duration" name="contract_duration" placeholder="E.g., Permanent, 6 months, 1 year">
        </div>
        <div class="form-group optional-field" id="time-commitment-group">
            <label for="time-commitment">Time Commitment:</label>
            <input type="text" id="time-commitment" name="time_commitment" placeholder="E.g., Full-time, Part-time (20 hrs/week)">
        </div>
    </div>
    
    <!-- Detailed Role Description -->
    <div class="form-section">
        <h2>Role Description</h2>
        <div class="field-checkboxes">
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('job-summary')">
                Job Summary
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('day-to-day')">
                Day-to-Day Tasks
            </label>
            <label class="field-checkbox">
                <input type="checkbox" onchange="toggleField('performance')">
                Performance Indicators
            </label>
            <label class="field-checkbox">
                <input type="checkbox" onchange="toggleField('decision-making')">
                Decision Making
            </label>
            <label class="field-checkbox">
                <input type="checkbox" onchange="toggleField('stakeholders')">
                Stakeholder Interactions
            </label>
        </div>
        
        <div class="form-group optional-field" id="day-to-day-group">
            <label for="day-to-day">Day-to-Day Tasks:</label>
            <textarea id="day-to-day" name="day_to_day_tasks" placeholder="List the main responsibilities and regular tasks"></textarea>
            <div class="field-hint">Describe what the person in this role will actually do day-to-day.</div>
        </div>
        <div class="form-group optional-field" id="performance-group">
            <label for="performance">Performance Indicators:</label>
            <textarea id="performance" name="performance_indicators" placeholder="How success will be measured in this role"></textarea>
        </div>
        <div class="form-group optional-field" id="decision-making-group">
            <label for="decision-making">Decision-Making Responsibilities:</label>
            <textarea id="decision-making" name="decision_making" placeholder="What decisions this role will be responsible for"></textarea>
        </div>
        <div class="form-group optional-field" id="stakeholders-group">
            <label for="stakeholders">Stakeholder Interactions:</label>
            <textarea id="stakeholders" name="stakeholder_interactions" placeholder="Key internal and external relationships"></textarea>
        </div>
    </div>
    
    <!-- Requirements - Essential Fields -->
    <div class="form-section">
        <h2>Requirements</h2>
        <div class="essential-fields">
            <div class="form-group optional-field" id="required-qualifications-group">
                <label for="required-qualifications">Required Qualifications:</label>
                <textarea id="required-qualifications" name="required_qualifications" placeholder="List must-have qualifications for this role"></textarea>
                <div class="field-hint">These are the non-negotiable requirements for the role.</div>
            </div>
        </div>
        
        <div class="field-checkboxes">
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('required-qualifications')">
                Required Qualifications
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('preferred-qualifications')">
                Preferred Qualifications
            </label>
            <label class="field-checkbox">
                <input type="checkbox" onchange="toggleField('certifications')">
                Certifications
            </label>
            <label class="field-checkbox">
                <input type="checkbox" onchange="toggleField('legal')">
                Legal Eligibility
            </label>
            <label class="field-checkbox">
                <input type="checkbox" onchange="toggleField('background-checks')">
                Background Checks
            </label>
            <label class="field-checkbox">
                <input type="checkbox" onchange="toggleField('clearance')">
                Clearance Level
            </label>
        </div>
        
        <div class="form-group optional-field" id="preferred-qualifications-group">
            <label for="preferred-qualifications">Preferred Qualifications:</label>
            <textarea id="preferred-qualifications" name="preferred_qualifications" placeholder="Nice-to-have qualifications that would be beneficial"></textarea>
            <div class="field-hint">Additional qualifications that would be advantageous but aren't required.</div>
        </div>
        <div class="form-group optional-field" id="certifications-group">
            <label for="certifications">Mandatory Certifications:</label>
            <textarea id="certifications" name="mandatory_certifications" placeholder="Required certifications or licenses"></textarea>
        </div>
        <div class="form-group optional-field" id="legal-group">
            <label for="legal">Legal Eligibility:</label>
            <input type="text" id="legal" name="legal_eligibility" placeholder="Required work authorization, etc.">
        </div>
        <div class="form-group optional-field" id="background-checks-group">
            <label for="background-checks">Background Checks:</label>
            <input type="text" id="background-checks" name="background_checks" placeholder="Required background checks">
        </div>
        <div class="form-group optional-field" id="clearance-group">
            <label for="clearance">Clearance Level:</label>
            <input type="text" id="clearance" name="clearance_level" placeholder="Required security clearance">
        </div>
    </div>
    
    <!-- Skills -->
    <div class="form-section">
        <h2>Skills</h2>
        <div class="field-checkboxes">
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('hard-skills')">
                Hard Skills
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('soft-skills')">
                Soft Skills
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('domain-expertise')">
                Domain Expertise
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('methodologies')">
                Methodologies
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('languages')">
                Languages
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('skills-priority')">
                Skills Priority
            </label>
        </div>
        
        <div class="form-group optional-field" id="hard-skills-group">
            <label for="hard-skills">Hard Skills:</label>
            <textarea id="hard-skills" name="hard_skills" placeholder="Technical skills required"></textarea>
        </div>
        <div class="form-group optional-field" id="soft-skills-group">
            <label for="soft-skills">Soft Skills:</label>
            <textarea id="soft-skills" name="soft_skills" placeholder="Interpersonal skills required"></textarea>
        </div>
        <div class="form-group optional-field" id="domain-expertise-group">
            <label for="domain-expertise">Domain Expertise:</label>
            <textarea id="domain-expertise" name="domain_expertise" placeholder="Industry knowledge required"></textarea>
        </div>
        <div class="form-group optional-field" id="methodologies-group">
            <label for="methodologies">Methodologies:</label>
            <textarea id="methodologies" name="methodologies" placeholder="Agile, Scrum, etc."></textarea>
        </div>
        <div class="form-group optional-field" id="languages-group">
            <label for="languages">Languages:</label>
            <textarea id="languages" name="languages" placeholder="Programming languages or spoken languages"></textarea>
        </div>
        <div class="form-group optional-field" id="skills-priority-group">
            <label for="skills-priority">Skills Priority:</label>
            <textarea id="skills-priority" name="skills_priority" placeholder="Prioritization of required skills"></textarea>
        </div>
    </div>
    
    <!-- Compensation -->
    <div class="form-section">
        <h2>Compensation</h2>
        <div class="field-checkboxes">
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('base-salary')">
                Base Salary
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('bonus')">
                Bonus Structure
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('equity')">
                Equity Options
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('benefits')">
                Benefits
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('relocation')">
                Relocation
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('visa')">
                Visa Sponsorship
            </label>
        </div>
        
        <div class="form-group optional-field" id="base-salary-group">
            <label for="base-salary">Base Salary:</label>
            <input type="text" id="base-salary" name="base_salary" placeholder="Salary range">
        </div>
        <div class="form-group optional-field" id="bonus-group">
            <label for="bonus">Bonus Structure:</label>
            <textarea id="bonus" name="bonus_structure" placeholder="Performance bonuses, profit sharing, etc."></textarea>
        </div>
        <div class="form-group optional-field" id="equity-group">
            <label for="equity">Equity Options:</label>
            <textarea id="equity" name="equity_options" placeholder="Stock options, RSUs, etc."></textarea>
        </div>
        <div class="form-group optional-field" id="benefits-group">
            <label for="benefits">Benefits:</label>
            <textarea id="benefits" name="benefits" placeholder="Health insurance, retirement, etc."></textarea>
        </div>
        <div class="form-group optional-field" id="relocation-group">
            <label for="relocation">Relocation Assistance:</label>
            <input type="text" id="relocation" name="relocation_assistance" placeholder="Available relocation support">
        </div>
        <div class="form-group optional-field" id="visa-group">
            <label for="visa">Visa Sponsorship:</label>
            <input type="text" id="visa" name="visa_sponsorship" placeholder="Available visa sponsorship">
        </div>
    </div>
    
    <!-- Work Environment -->
    <div class="form-section">
        <h2>Work Environment</h2>
        <div class="field-checkboxes">
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('work-model')">
                Work Model
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('work-locations')">
                Work Locations
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('travel')">
                Travel Requirements
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('shift-type')">
                Shift Type
            </label>
        </div>
        
        <div class="form-group optional-field" id="work-locations-group">
            <label for="work-locations">Work Locations:</label>
            <textarea id="work-locations" name="work_locations" placeholder="Possible work locations"></textarea>
        </div>
        <div class="form-group optional-field" id="travel-group">
            <label for="travel">Travel Requirements:</label>
            <input type="text" id="travel" name="travel_requirements" placeholder="Expected travel percentage">
        </div>
        <div class="form-group optional-field" id="shift-type-group">
            <label for="shift-type">Shift Type:</label>
            <input type="text" id="shift-type" name="shift_type" placeholder="Regular, rotating, on-call, etc.">
        </div>
    </div>
    
    <!-- Career Development -->
    <div class="form-section">
        <h2>Career Development</h2>
        <div class="field-checkboxes">
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('growth-opportunities')">
                Growth Opportunities
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('training')">
                Training & Development
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('mentorship')">
                Mentorship
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('succession')">
                Succession Planning
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('culture-link')">
                Culture Link
            </label>
            <label class="field-checkbox">
                <input type="checkbox" checked onchange="toggleField('careers-link')">
                Careers Link
            </label>
        </div>
        
        <div class="form-group optional-field" id="growth-opportunities-group">
            <label for="growth-opportunities">Growth Opportunities:</label>
            <textarea id="growth-opportunities" name="growth_opportunities" placeholder="Career advancement possibilities"></textarea>
        </div>
        <div class="form-group optional-field" id="training-group">
            <label for="training">Training & Development:</label>
            <textarea id="training" name="training_development" placeholder="Learning opportunities provided"></textarea>
        </div>
        <div class="form-group optional-field" id="mentorship-group">
            <label for="mentorship">Mentorship:</label>
            <textarea id="mentorship" name="mentorship" placeholder="Mentoring programs available"></textarea>
        </div>
        <div class="form-group optional-field" id="succession-group">
            <label for="succession">Succession Planning:</label>
            <textarea id="succession" name="succession_planning" placeholder="Future role progression"></textarea>
        </div>
        <div class="form-group optional-field" id="culture-link-group">
            <label for="culture-link">Company Culture Link:</label>
            <input type="url" id="culture-link" name="culture_page_link" placeholder="URL to company culture page">
        </div>
        <div class="form-group optional-field" id="careers-link-group">
            <label for="careers-link">Company Careers Link:</label>
            <input type="url" id="careers-link" name="careers_page_link" placeholder="URL to company careers page">
        </div>
    </div>
</form>

<script>
// Toggle field visibility
function toggleField(fieldId) {
    const group = document.getElementById(fieldId + '-group');
    if (group) {
        group.style.display = group.style.display === 'none' ? 'block' : 'none';
        updateFormProgress('job-form');
    }
}

// Toggle compact form view
function toggleCompactForm(formId) {
    const form = document.getElementById(formId);
    if (form) {
        form.classList.toggle('job-form-compact');
        updateFormProgress(formId);
    }
}

// Update form progress bar
function updateFormProgress(formId) {
    const form = document.getElementById(formId);
    const progressBar = document.getElementById(formId + '-progress');
    const progressPercent = document.getElementById(formId + '-progress-percent');
    
    if (form && progressBar) {
        const totalFields = form.querySelectorAll('.form-group').length;
        const filledFields = form.querySelectorAll('.form-group input:not([value=""]), .form-group textarea:not(:empty)').length;
        
        const progress = Math.round((filledFields / totalFields) * 100);
        progressBar.style.width = progress + '%';
        if (progressPercent) {
            progressPercent.innerText = progress + '%';
        }
    }
}

// JD Upload Functions
let selectedFile = null;

function triggerFileInput() {
    document.getElementById('jd-file-input').click();
}

function handleDragOver(event) {
    event.preventDefault();
    event.stopPropagation();
    document.getElementById('upload-box').classList.add('drag-over');
}

function handleDrop(event) {
    event.preventDefault();
    event.stopPropagation();
    document.getElementById('upload-box').classList.remove('drag-over');
    
    if (event.dataTransfer.files.length) {
        const file = event.dataTransfer.files[0];
        processSelectedFile(file);
    }
}

function handleFileSelect(event) {
    if (event.target.files.length) {
        const file = event.target.files[0];
        processSelectedFile(file);
    }
}

function processSelectedFile(file) {
    // Check file type
    const validTypes = [
        'application/pdf', 
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
        'application/msword',
        'image/jpeg',
        'image/png'
    ];
    
    if (!validTypes.includes(file.type)) {
        alert('Invalid file type. Please upload PDF, DOCX, DOC, JPG, or PNG files.');
        return;
    }
    
    // Check file size (max 5MB)
    const maxSize = 5 * 1024 * 1024; // 5MB in bytes
    if (file.size > maxSize) {
        alert('File is too large. Maximum size is 5MB.');
        return;
    }
    
    // Store file in global variable
    selectedFile = file;
    
    // Update UI
    document.getElementById('file-name').textContent = file.name;
    document.getElementById('file-size').textContent = formatFileSize(file.size);
    document.getElementById('file-info').style.display = 'flex';
    document.getElementById('upload-jd-btn').disabled = false;
    
    // Hide previous results if any
    document.getElementById('processing-results').style.display = 'none';
}

function formatFileSize(bytes) {
    if (bytes < 1024) return bytes + ' bytes';
    else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
    else return (bytes / 1048576).toFixed(1) + ' MB';
}

function removeFile() {
    selectedFile = null;
    document.getElementById('jd-file-input').value = '';
    document.getElementById('file-info').style.display = 'none';
    document.getElementById('upload-jd-btn').disabled = true;
}

async function uploadJobDescription() {
    if (!selectedFile) {
        alert('Please select a file to upload');
        return;
    }
    
    // Disable upload button and show progress
    const uploadBtn = document.getElementById('upload-jd-btn');
    uploadBtn.disabled = true;
    uploadBtn.textContent = 'Processing...';
    
    const uploadProgress = document.getElementById('upload-progress');
    const progressFill = document.getElementById('progress-fill');
    const progressStatus = document.getElementById('progress-status');
    
    uploadProgress.style.display = 'block';
    progressFill.style.width = '10%';
    progressStatus.textContent = 'Uploading file...';
    
    try {
        // Create form data
        const formData = new FormData();
        formData.append('file', selectedFile);
        
        // Extract stage
        progressFill.style.width = '30%';
        progressStatus.textContent = 'Extracting information...';
        
        const extractResponse = await fetch('/jd/extract', {
            method: 'POST',
            body: formData
        });
        
        const extractData = await extractResponse.json();
        if (extractData.status !== 'success') {
            throw new Error(extractData.detail || 'Failed to extract job description');
        }
        
        // Enhancement stage
        progressFill.style.width = '70%';
        progressStatus.textContent = 'Enhancing job description...';
        
        const enhanceResponse = await fetch('/jd/enhance', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(extractData.data)
        });
        
        const enhanceData = await enhanceResponse.json();
        if (enhanceData.status !== 'success') {
            throw new Error(enhanceData.detail || 'Failed to enhance job description');
        }
        
        // Display results
        progressFill.style.width = '100%';
        progressStatus.textContent = 'Completed';
        
        // Store the enhanced data for later use
        window.enhancedJobData = enhanceData.data;
        
        // Display the extracted data
        displayExtractedData(enhanceData.data);
        
    } catch (error) {
        console.error('Error processing job description:', error);
        progressStatus.textContent = 'Error: ' + error.message;
        progressFill.style.backgroundColor = '#ff4d4d';
    } finally {
        uploadBtn.disabled = false;
        uploadBtn.textContent = 'Upload & Process';
    }
}

function displayExtractedData(data) {
    const extractedDataContainer = document.getElementById('extracted-data');
    const processingResults = document.getElementById('processing-results');
    
    // Format the data for display
    let html = '';
    
    // Enhanced JD data
    const enhancedJd = data.enhanced_jd;
    html += `<h4>Job Title: ${enhancedJd.job_title}</h4>`;
    html += `<p><strong>Industry:</strong> ${enhancedJd.industry_name}</p>`;
    html += `<p><strong>Experience Required:</strong> ${enhancedJd.min_work_experience || 'Not specified'} years</p>`;
    
    html += '<h4>Role Summary:</h4>';
    html += `<p>${enhancedJd.role_summary}</p>`;
    
    html += '<h4>Responsibilities:</h4>';
    html += '<ul>';
    enhancedJd.responsibilities.slice(0, 5).forEach(resp => {
        html += `<li>${resp}</li>`;
    });
    if (enhancedJd.responsibilities.length > 5) {
        html += `<li>...and ${enhancedJd.responsibilities.length - 5} more</li>`;
    }
    html += '</ul>';
    
    html += '<h4>Required Skills:</h4>';
    html += '<ul>';
    enhancedJd.required_skills.slice(0, 5).forEach(skill => {
        html += `<li>${skill}</li>`;
    });
    if (enhancedJd.required_skills.length > 5) {
        html += `<li>...and ${enhancedJd.required_skills.length - 5} more</li>`;
    }
    html += '</ul>';
    
    // Update the UI
    extractedDataContainer.innerHTML = html;
    processingResults.style.display = 'block';
}

function useExtractedResults() {
    if (!window.enhancedJobData) {
        alert('No extracted data available');
        return;
    }
    
    // Get the job form data
    const formData = window.enhancedJobData.job_form_data;
    
    // Get the job form and fill it with the extracted data
    const form = document.getElementById('job-form');
    
    // For each field in the form, set the value if available in formData
    for (const input of form.elements) {
        if (input.name && formData[input.name] !== undefined) {
            if (input.tagName === 'TEXTAREA') {
                input.value = formData[input.name] || '';
            } else if (input.tagName === 'INPUT') {
                input.value = formData[input.name] || '';
            }
        }
    }
    
    // Hide the upload container and scroll to the form
    document.getElementById('jd-upload-container').style.display = 'none';
    document.getElementById('job-form-container').scrollIntoView({ behavior: 'smooth' });
    
    // Show success message
    showResponse('job-response', 'Job description data has been filled in the form. Review and submit when ready.', 'success');
}

function editExtractedResults() {
    if (!window.enhancedJobData) {
        alert('No extracted data available');
        return;
    }
    
    // Hide the upload container and show the form
    document.getElementById('jd-upload-container').style.display = 'none';
    
    // Pre-fill with basic data
    const formData = window.enhancedJobData.job_form_data;
    const form = document.getElementById('job-form');
    
    // Fill in just the title and summary to start
    const titleInput = form.querySelector('[name="title"]');
    if (titleInput) titleInput.value = formData.title || '';
    
    const summaryInput = form.querySelector('[name="job_summary"]');
    if (summaryInput) summaryInput.value = formData.job_summary || '';
    
    // Scroll to the form
    document.getElementById('job-form-container').scrollIntoView({ behavior: 'smooth' });
    
    // Show hint message
    showResponse('job-response', 'You can now manually edit the job description form.', 'info');
}

// Helper function to show response messages
function showResponse(elementId, message, type) {
    // Create response element if it doesn't exist
    let element = document.getElementById(elementId);
    if (!element) {
        element = document.createElement('div');
        element.id = elementId;
        document.querySelector('.form-progress').after(element);
    }
    
    element.textContent = message;
    element.className = 'response ' + type;
    element.style.display = 'block';
    
    // Hide after 5 seconds for success messages
    if (type === 'success') {
        setTimeout(() => {
            element.style.display = 'none';
        }, 5000);
    }
}

// Initialize form state
document.addEventListener('DOMContentLoaded', function() {
    updateFormProgress('job-form');
});
</script>

<!-- Add CSS styles for the JD upload component -->
<style>
.jd-upload-container {
    max-width: 800px;
    margin: 20px auto;
    padding: 20px;
    background-color: #f9f9f9;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
}

.upload-description {
    margin-bottom: 20px;
    color: #555;
}

.upload-box {
    border: 2px dashed #ccc;
    border-radius: 8px;
    padding: 40px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background-color: #f9f9f9;
    margin-bottom: 20px;
}

.upload-box:hover {
    border-color: #4a90e2;
    background-color: #f0f7ff;
}

.upload-box.drag-over {
    border-color: #4a90e2;
    background-color: #e6f0fc;
}

.upload-icon {
    margin-bottom: 15px;
    color: #555;
}

.browse-text {
    color: #4a90e2;
    font-weight: 600;
}

.supported-formats {
    font-size: 12px;
    color: #888;
    margin-top: 10px;
}

.file-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 10px 15px;
    background-color: #f5f5f5;
    margin-bottom: 20px;
}

.file-details {
    display: flex;
    flex-direction: column;
}

#file-name {
    font-weight: 600;
    margin-bottom: 5px;
}

#file-size {
    font-size: 12px;
    color: #666;
}

.remove-file-btn {
    background: none;
    border: none;
    color: #ff4d4d;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
}

.upload-actions {
    margin-bottom: 20px;
}

#upload-jd-btn {
    width: 100%;
    padding: 12px;
    background-color: #4a90e2;
    color: white;
    border: none;
    border-radius: 4px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

#upload-jd-btn:hover {
    background-color: #3a7bc8;
}

#upload-jd-btn:disabled {
    background-color: #b0c8e2;
    cursor: not-allowed;
}

.upload-progress {
    margin-top: 20px;
    margin-bottom: 30px;
}

.progress-bar {
    height: 6px;
    background-color: #e0e0e0;
    border-radius: 3px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background-color: #4caf50;
    width: 0;
    transition: width 0.3s ease;
}

.progress-status {
    text-align: center;
    margin-top: 8px;
    font-size: 14px;
    color: #666;
}

.processing-results {
    margin-top: 30px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 20px;
    background-color: #fff;
}

#extracted-data {
    margin-bottom: 20px;
    max-height: 300px;
    overflow-y: auto;
    padding: 15px;
    background-color: #f9f9f9;
    border-radius: 4px;
    border: 1px solid #e0e0e0;
}

.result-actions {
    display: flex;
    gap: 15px;
}

#use-results-btn, #edit-results-btn {
    flex: 1;
    padding: 10px;
    border-radius: 4px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

#use-results-btn {
    background-color: #4caf50;
    color: white;
    border: none;
}

#use-results-btn:hover {
    background-color: #409444;
}

#edit-results-btn {
    background-color: white;
    color: #4a90e2;
    border: 1px solid #4a90e2;
}

#edit-results-btn:hover {
    background-color: #f0f7ff;
}

.response {
    padding: 15px;
    border-radius: 5px;
    margin: 15px 0;
    font-weight: 500;
}

.response.success {
    background-color: #e6f7e6;
    color: #2e7d32;
    border-left: 4px solid #4caf50;
}

.response.error {
    background-color: #ffebee;
    color: #c62828;
    border-left: 4px solid #f44336;
}

.response.info {
    background-color: #e3f2fd;
    color: #0d47a1;
    border-left: 4px solid #2196f3;
}
</style> 